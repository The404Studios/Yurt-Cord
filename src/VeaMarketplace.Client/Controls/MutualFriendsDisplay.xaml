<UserControl x:Class="VeaMarketplace.Client.Controls.MutualFriendsDisplay"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:converters="clr-namespace:VeaMarketplace.Client.Converters">

    <UserControl.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVis"/>
    </UserControl.Resources>

    <StackPanel x:Name="RootPanel" Visibility="Collapsed">
        <!-- Header -->
        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
            <TextBlock x:Name="CountText" Text="3"
                       FontSize="12" FontWeight="Bold"
                       Foreground="{StaticResource TextSecondaryBrush}"/>
            <TextBlock Text=" MUTUAL FRIENDS"
                       FontSize="12" FontWeight="Bold"
                       Foreground="{StaticResource TextSecondaryBrush}"/>
        </StackPanel>

        <!-- Avatar Stack -->
        <Grid>
            <StackPanel x:Name="AvatarStack" Orientation="Horizontal">
                <!-- Avatars added programmatically -->
            </StackPanel>

            <!-- View All Button -->
            <Button x:Name="ViewAllButton" Style="{StaticResource LinkButton}"
                    Content="View All" HorizontalAlignment="Right"
                    VerticalAlignment="Center"
                    Click="ViewAllButton_Click"
                    Visibility="Collapsed"/>
        </Grid>

        <!-- Expanded List (shown when expanded) -->
        <Border x:Name="ExpandedList" Visibility="Collapsed"
                Background="{StaticResource SecondaryDarkBrush}"
                CornerRadius="8" Margin="0,8,0,0" Padding="8">
            <ItemsControl x:Name="FriendsListControl">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Padding="8,6" Cursor="Hand"
                                Background="Transparent"
                                MouseLeftButtonDown="FriendItem_Click">
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background"
                                                    Value="{StaticResource TertiaryDarkBrush}"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Avatar with status -->
                                <Grid Grid.Column="0" Margin="0,0,10,0">
                                    <Border Width="32" Height="32" CornerRadius="16">
                                        <Ellipse Width="32" Height="32">
                                            <Ellipse.Fill>
                                                <ImageBrush ImageSource="{Binding AvatarUrl}"
                                                            Stretch="UniformToFill"/>
                                            </Ellipse.Fill>
                                        </Ellipse>
                                    </Border>
                                    <Ellipse Width="10" Height="10"
                                             HorizontalAlignment="Right"
                                             VerticalAlignment="Bottom"
                                             Fill="{Binding StatusColor}"
                                             Stroke="{StaticResource SecondaryDarkBrush}"
                                             StrokeThickness="2"/>
                                </Grid>

                                <!-- Name -->
                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                    <TextBlock Text="{Binding DisplayName}"
                                               FontSize="13" FontWeight="SemiBold"
                                               Foreground="{StaticResource TextPrimaryBrush}"/>
                                    <TextBlock Text="{Binding Username, StringFormat=@{0}}"
                                               FontSize="11"
                                               Foreground="{StaticResource TextMutedBrush}"
                                               Visibility="{Binding ShowUsername, Converter={StaticResource BoolToVis}}"/>
                                </StackPanel>

                                <!-- Action -->
                                <Button Grid.Column="2" Style="{StaticResource IconButton}"
                                        Content="ðŸ’¬" FontSize="14"
                                        ToolTip="Message"
                                        Click="MessageFriend_Click"
                                        Tag="{Binding Id}"/>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </Border>
    </StackPanel>
</UserControl>
