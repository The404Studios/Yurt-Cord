<UserControl x:Class="VeaMarketplace.Client.Views.MemberSidebar"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:controls="clr-namespace:VeaMarketplace.Client.Controls"
             Background="Transparent">

    <UserControl.Resources>
        <ResourceDictionary>
            <BooleanToVisibilityConverter x:Key="BoolToVis"/>

            <!-- Blade Member Context Menu -->
            <ContextMenu x:Key="MemberContextMenu" Style="{StaticResource BladeContextMenu}">
                <MenuItem Header="View Profile" Style="{StaticResource BladeMenuItem}"
                          Click="ViewProfile_Click">
                    <MenuItem.Icon>
                        <TextBlock Text="ðŸ‘¤" FontSize="14"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Send Message" Style="{StaticResource BladeMenuItem}"
                          Click="SendMessage_Click">
                    <MenuItem.Icon>
                        <TextBlock Text="ðŸ’¬" FontSize="14"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Add Friend" Style="{StaticResource BladeMenuItem}"
                          Click="AddFriend_Click">
                    <MenuItem.Icon>
                        <TextBlock Text="âž•" FontSize="14"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator Style="{StaticResource BladeMenuSeparator}"/>
                <MenuItem Header="Mention" Style="{StaticResource BladeMenuItem}"
                          Click="Mention_Click">
                    <MenuItem.Icon>
                        <TextBlock Text="@" FontSize="14"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Invite to Voice" Style="{StaticResource BladeMenuItem}"
                          Click="InviteToVoice_Click">
                    <MenuItem.Icon>
                        <TextBlock Text="ðŸŽ¤" FontSize="14"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator Style="{StaticResource BladeMenuSeparator}"/>
                <MenuItem Header="Mute" Style="{StaticResource BladeMenuItem}"
                          Click="MuteUser_Click">
                    <MenuItem.Icon>
                        <TextBlock Text="ðŸ”‡" FontSize="14"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Block" Style="{StaticResource BladeDangerMenuItem}"
                          Click="BlockUser_Click">
                    <MenuItem.Icon>
                        <TextBlock Text="ðŸš«" FontSize="14"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator Style="{StaticResource BladeMenuSeparator}"/>
                <MenuItem Header="Copy User ID" Style="{StaticResource BladeMenuItem}"
                          Click="CopyUserId_Click">
                    <MenuItem.Icon>
                        <TextBlock Text="ðŸ“‹" FontSize="14"/>
                    </MenuItem.Icon>
                </MenuItem>
            </ContextMenu>

            <!-- Blade Member Item Style -->
            <Style x:Key="BladeMemberItem" TargetType="Border">
                <Setter Property="Cursor" Value="Hand"/>
                <Setter Property="Margin" Value="6,2"/>
                <Setter Property="CornerRadius" Value="8"/>
                <Setter Property="Padding" Value="12,10"/>
                <Setter Property="Background" Value="Transparent"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="BorderBrush" Value="Transparent"/>
                <Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
                <Setter Property="RenderTransform">
                    <Setter.Value>
                        <TransformGroup>
                            <ScaleTransform ScaleX="1" ScaleY="1"/>
                            <TranslateTransform X="0" Y="0"/>
                        </TransformGroup>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- Blade slide-in animation -->
            <Storyboard x:Key="BladeSlideIn">
                <DoubleAnimation Storyboard.TargetName="MainPanel"
                                 Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.X)"
                                 From="100" To="0" Duration="0:0:0.4">
                    <DoubleAnimation.EasingFunction>
                        <BackEase EasingMode="EaseOut" Amplitude="0.2"/>
                    </DoubleAnimation.EasingFunction>
                </DoubleAnimation>
                <DoubleAnimation Storyboard.TargetName="MainPanel"
                                 Storyboard.TargetProperty="Opacity"
                                 From="0" To="1" Duration="0:0:0.3"/>
            </Storyboard>
        </ResourceDictionary>
    </UserControl.Resources>

    <UserControl.Triggers>
        <EventTrigger RoutedEvent="Loaded">
            <BeginStoryboard Storyboard="{StaticResource BladeSlideIn}"/>
        </EventTrigger>
    </UserControl.Triggers>

    <Grid x:Name="MainPanel">
        <Grid.RenderTransform>
            <TranslateTransform X="0"/>
        </Grid.RenderTransform>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header Blade Panel -->
        <Border Grid.Row="0" Margin="8,8,8,4" CornerRadius="4,12,12,4">
            <Border.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0.3">
                    <GradientStop Color="#18101828" Offset="0"/>
                    <GradientStop Color="#25182030" Offset="0.5"/>
                    <GradientStop Color="#18101828" Offset="1"/>
                </LinearGradientBrush>
            </Border.Background>
            <Border.BorderBrush>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                    <GradientStop Color="#5000FF9F" Offset="0"/>
                    <GradientStop Color="#30B366FF" Offset="1"/>
                </LinearGradientBrush>
            </Border.BorderBrush>
            <Border.BorderThickness>1</Border.BorderThickness>
            <Border.Effect>
                <DropShadowEffect Color="#00FF9F" BlurRadius="12" ShadowDepth="0" Opacity="0.3"/>
            </Border.Effect>

            <Grid Height="52">
                <!-- Accent stripe -->
                <Border Width="4" HorizontalAlignment="Left" CornerRadius="4,0,0,4">
                    <Border.Background>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                            <GradientStop Color="#00FF9F" Offset="0"/>
                            <GradientStop Color="#B366FF" Offset="1"/>
                        </LinearGradientBrush>
                    </Border.Background>
                </Border>

                <Grid Margin="18,0,12,0">
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <!-- Member icon -->
                        <Border CornerRadius="8" Width="32" Height="32" Margin="0,0,12,0">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Color="#00FF9F" Offset="0"/>
                                    <GradientStop Color="#B366FF" Offset="1"/>
                                </LinearGradientBrush>
                            </Border.Background>
                            <Border.Effect>
                                <DropShadowEffect Color="#00FF9F" BlurRadius="10" ShadowDepth="0" Opacity="0.6"/>
                            </Border.Effect>
                            <TextBlock Text="ðŸ‘¥" FontSize="14" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <TextBlock Text="MEMBERS" FontSize="12" FontWeight="Bold"
                                   Foreground="#8090B0" VerticalAlignment="Center"/>
                    </StackPanel>

                    <Button x:Name="GroupCallButton" Style="{StaticResource BladeIconButton}"
                            Width="38" Height="38" HorizontalAlignment="Right"
                            ToolTip="Start Group Call" Click="StartGroupCall_Click">
                        <Border CornerRadius="8" Padding="6">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Color="#3000FF9F" Offset="0"/>
                                    <GradientStop Color="#30B366FF" Offset="1"/>
                                </LinearGradientBrush>
                            </Border.Background>
                            <TextBlock Text="ðŸ“ž" FontSize="14"/>
                        </Border>
                    </Button>
                </Grid>
            </Grid>
        </Border>

        <!-- Members List -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto"
                      Style="{StaticResource BladeScrollViewer}"
                      Margin="4,4,4,8">
            <StackPanel>
                <!-- Online Members Section -->
                <Border Margin="8,8,8,4" Padding="10,6" CornerRadius="6"
                        Background="#10101828">
                    <StackPanel Orientation="Horizontal">
                        <Ellipse Width="8" Height="8" Margin="0,0,10,0">
                            <Ellipse.Fill>
                                <SolidColorBrush Color="#00FF9F"/>
                            </Ellipse.Fill>
                            <Ellipse.Effect>
                                <DropShadowEffect Color="#00FF9F" BlurRadius="8" ShadowDepth="0"/>
                            </Ellipse.Effect>
                        </Ellipse>
                        <TextBlock x:Name="OnlineHeaderText" Text="ONLINE â€” 0"
                                   FontSize="11" FontWeight="SemiBold"
                                   Foreground="#6080A0" CharacterSpacing="30"/>
                    </StackPanel>
                </Border>

                <ItemsControl x:Name="OnlineMembersControl">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Cursor="Hand" Margin="6,3" CornerRadius="10"
                                    Padding="12,10"
                                    ContextMenu="{StaticResource MemberContextMenu}"
                                    Tag="{Binding}"
                                    MouseLeftButtonUp="Member_Click"
                                    RenderTransformOrigin="0.5,0.5">
                                <Border.RenderTransform>
                                    <TransformGroup>
                                        <ScaleTransform x:Name="ItemScale" ScaleX="1" ScaleY="1"/>
                                        <TranslateTransform x:Name="ItemTranslate" X="0" Y="0"/>
                                    </TransformGroup>
                                </Border.RenderTransform>
                                <Border.Background>
                                    <SolidColorBrush Color="Transparent"/>
                                </Border.Background>
                                <Border.BorderBrush>
                                    <SolidColorBrush Color="Transparent"/>
                                </Border.BorderBrush>
                                <Border.BorderThickness>1</Border.BorderThickness>
                                <Border.Effect>
                                    <DropShadowEffect Color="#00FF9F" BlurRadius="0" ShadowDepth="0" Opacity="0"/>
                                </Border.Effect>
                                <Border.Triggers>
                                    <EventTrigger RoutedEvent="MouseEnter">
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <ColorAnimation Storyboard.TargetProperty="(Border.Background).(SolidColorBrush.Color)"
                                                                To="#20101828" Duration="0:0:0.2"/>
                                                <ColorAnimation Storyboard.TargetProperty="(Border.BorderBrush).(SolidColorBrush.Color)"
                                                                To="#4000FF9F" Duration="0:0:0.2"/>
                                                <DoubleAnimation Storyboard.TargetProperty="(Border.Effect).(DropShadowEffect.BlurRadius)"
                                                                 To="12" Duration="0:0:0.2"/>
                                                <DoubleAnimation Storyboard.TargetProperty="(Border.Effect).(DropShadowEffect.Opacity)"
                                                                 To="0.4" Duration="0:0:0.2"/>
                                                <DoubleAnimation Storyboard.TargetName="ItemScale"
                                                                 Storyboard.TargetProperty="ScaleX"
                                                                 To="1.02" Duration="0:0:0.2">
                                                    <DoubleAnimation.EasingFunction>
                                                        <CubicEase EasingMode="EaseOut"/>
                                                    </DoubleAnimation.EasingFunction>
                                                </DoubleAnimation>
                                                <DoubleAnimation Storyboard.TargetName="ItemScale"
                                                                 Storyboard.TargetProperty="ScaleY"
                                                                 To="1.02" Duration="0:0:0.2">
                                                    <DoubleAnimation.EasingFunction>
                                                        <CubicEase EasingMode="EaseOut"/>
                                                    </DoubleAnimation.EasingFunction>
                                                </DoubleAnimation>
                                                <DoubleAnimation Storyboard.TargetName="ItemTranslate"
                                                                 Storyboard.TargetProperty="Y"
                                                                 To="-2" Duration="0:0:0.2"/>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </EventTrigger>
                                    <EventTrigger RoutedEvent="MouseLeave">
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <ColorAnimation Storyboard.TargetProperty="(Border.Background).(SolidColorBrush.Color)"
                                                                To="Transparent" Duration="0:0:0.3"/>
                                                <ColorAnimation Storyboard.TargetProperty="(Border.BorderBrush).(SolidColorBrush.Color)"
                                                                To="Transparent" Duration="0:0:0.3"/>
                                                <DoubleAnimation Storyboard.TargetProperty="(Border.Effect).(DropShadowEffect.BlurRadius)"
                                                                 To="0" Duration="0:0:0.3"/>
                                                <DoubleAnimation Storyboard.TargetProperty="(Border.Effect).(DropShadowEffect.Opacity)"
                                                                 To="0" Duration="0:0:0.3"/>
                                                <DoubleAnimation Storyboard.TargetName="ItemScale"
                                                                 Storyboard.TargetProperty="ScaleX"
                                                                 To="1" Duration="0:0:0.3"/>
                                                <DoubleAnimation Storyboard.TargetName="ItemScale"
                                                                 Storyboard.TargetProperty="ScaleY"
                                                                 To="1" Duration="0:0:0.3"/>
                                                <DoubleAnimation Storyboard.TargetName="ItemTranslate"
                                                                 Storyboard.TargetProperty="Y"
                                                                 To="0" Duration="0:0:0.3"/>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </EventTrigger>
                                </Border.Triggers>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Avatar with status glow -->
                                    <Grid Grid.Column="0" Margin="0,0,14,0">
                                        <Border Width="44" Height="44" CornerRadius="10"
                                                BorderThickness="2">
                                            <Border.BorderBrush>
                                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                    <GradientStop Color="#00FF9F" Offset="0"/>
                                                    <GradientStop Color="#00E5FF" Offset="1"/>
                                                </LinearGradientBrush>
                                            </Border.BorderBrush>
                                            <Border.Effect>
                                                <DropShadowEffect Color="#00FF9F" BlurRadius="10" ShadowDepth="0" Opacity="0.5"/>
                                            </Border.Effect>
                                            <Border CornerRadius="8">
                                                <Border.Background>
                                                    <ImageBrush ImageSource="{Binding AvatarUrl}" Stretch="UniformToFill"/>
                                                </Border.Background>
                                            </Border>
                                        </Border>
                                        <!-- Online indicator -->
                                        <Border Width="16" Height="16" CornerRadius="8"
                                                HorizontalAlignment="Right" VerticalAlignment="Bottom"
                                                Margin="0,0,-3,-3"
                                                Background="#020408" BorderThickness="3"
                                                BorderBrush="#020408">
                                            <Ellipse Fill="#00FF9F">
                                                <Ellipse.Effect>
                                                    <DropShadowEffect Color="#00FF9F" BlurRadius="6" ShadowDepth="0"/>
                                                </Ellipse.Effect>
                                            </Ellipse>
                                        </Border>
                                    </Grid>

                                    <!-- User Info -->
                                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                        <controls:UserNameplate Username="{Binding Username}"
                                                                Role="{Binding Role}"
                                                                Rank="{Binding Rank}"
                                                                ShowRoleBadge="True"
                                                                ShowRankBadge="True"
                                                                FontSizeOverride="14"/>
                                        <!-- Status Message -->
                                        <TextBlock Text="{Binding StatusMessage}" FontSize="11"
                                                   Foreground="#6080A0"
                                                   TextTrimming="CharacterEllipsis"
                                                   MaxWidth="120" Margin="0,3,0,0"
                                                   Visibility="{Binding StatusMessage, Converter={StaticResource StringToVisConverter}}"/>
                                    </StackPanel>

                                    <!-- Quick Actions (shown on hover) -->
                                    <StackPanel Grid.Column="2" Orientation="Horizontal"
                                                VerticalAlignment="Center" Opacity="0"
                                                x:Name="QuickActionsPanel">
                                        <Button Style="{StaticResource BladeIconButton}" Width="30" Height="30"
                                                ToolTip="Send Message" Margin="2,0">
                                            <TextBlock Text="ðŸ’¬" FontSize="12"/>
                                        </Button>
                                        <Button Style="{StaticResource BladeIconButton}" Width="30" Height="30"
                                                ToolTip="Nudge" Margin="2,0">
                                            <TextBlock Text="ðŸ‘‹" FontSize="12"/>
                                        </Button>
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <!-- Staff Section -->
                <Border Margin="8,16,8,4" Padding="10,6" CornerRadius="6"
                        Background="#10101828"
                        x:Name="StaffHeader" Visibility="Collapsed">
                    <StackPanel Orientation="Horizontal">
                        <Border Width="8" Height="8" CornerRadius="4" Margin="0,0,10,0">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Color="#FFD700" Offset="0"/>
                                    <GradientStop Color="#FF9500" Offset="1"/>
                                </LinearGradientBrush>
                            </Border.Background>
                            <Border.Effect>
                                <DropShadowEffect Color="#FFD700" BlurRadius="8" ShadowDepth="0"/>
                            </Border.Effect>
                        </Border>
                        <TextBlock Text="STAFF" FontSize="11" FontWeight="SemiBold"
                                   Foreground="#FFD700" CharacterSpacing="50">
                            <TextBlock.Effect>
                                <DropShadowEffect Color="#FFD700" BlurRadius="6" ShadowDepth="0" Opacity="0.5"/>
                            </TextBlock.Effect>
                        </TextBlock>
                    </StackPanel>
                </Border>

                <ItemsControl x:Name="StaffMembersControl" Visibility="Collapsed">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Cursor="Hand" Margin="6,2" CornerRadius="8"
                                    Padding="10,8"
                                    ContextMenu="{StaticResource MemberContextMenu}"
                                    Tag="{Binding}"
                                    RenderTransformOrigin="0.5,0.5">
                                <Border.RenderTransform>
                                    <TransformGroup>
                                        <ScaleTransform x:Name="StaffItemScale" ScaleX="1" ScaleY="1"/>
                                    </TransformGroup>
                                </Border.RenderTransform>
                                <Border.Background>
                                    <SolidColorBrush Color="#10FFD700"/>
                                </Border.Background>
                                <Border.BorderBrush>
                                    <SolidColorBrush Color="#30FFD700"/>
                                </Border.BorderBrush>
                                <Border.BorderThickness>1</Border.BorderThickness>
                                <Border.Effect>
                                    <DropShadowEffect Color="#FFD700" BlurRadius="8" ShadowDepth="0" Opacity="0.3"/>
                                </Border.Effect>
                                <Border.Triggers>
                                    <EventTrigger RoutedEvent="MouseEnter">
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <ColorAnimation Storyboard.TargetProperty="(Border.Background).(SolidColorBrush.Color)"
                                                                To="#25FFD700" Duration="0:0:0.2"/>
                                                <DoubleAnimation Storyboard.TargetProperty="(Border.Effect).(DropShadowEffect.BlurRadius)"
                                                                 To="15" Duration="0:0:0.2"/>
                                                <DoubleAnimation Storyboard.TargetName="StaffItemScale"
                                                                 Storyboard.TargetProperty="ScaleX"
                                                                 To="1.02" Duration="0:0:0.2"/>
                                                <DoubleAnimation Storyboard.TargetName="StaffItemScale"
                                                                 Storyboard.TargetProperty="ScaleY"
                                                                 To="1.02" Duration="0:0:0.2"/>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </EventTrigger>
                                    <EventTrigger RoutedEvent="MouseLeave">
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <ColorAnimation Storyboard.TargetProperty="(Border.Background).(SolidColorBrush.Color)"
                                                                To="#10FFD700" Duration="0:0:0.3"/>
                                                <DoubleAnimation Storyboard.TargetProperty="(Border.Effect).(DropShadowEffect.BlurRadius)"
                                                                 To="8" Duration="0:0:0.3"/>
                                                <DoubleAnimation Storyboard.TargetName="StaffItemScale"
                                                                 Storyboard.TargetProperty="ScaleX"
                                                                 To="1" Duration="0:0:0.3"/>
                                                <DoubleAnimation Storyboard.TargetName="StaffItemScale"
                                                                 Storyboard.TargetProperty="ScaleY"
                                                                 To="1" Duration="0:0:0.3"/>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </EventTrigger>
                                </Border.Triggers>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <Grid Grid.Column="0" Margin="0,0,12,0">
                                        <Border Width="36" Height="36" CornerRadius="8"
                                                BorderThickness="2">
                                            <Border.BorderBrush>
                                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                    <GradientStop Color="#FFD700" Offset="0"/>
                                                    <GradientStop Color="#FF9500" Offset="1"/>
                                                </LinearGradientBrush>
                                            </Border.BorderBrush>
                                            <Border.Effect>
                                                <DropShadowEffect Color="#FFD700" BlurRadius="8" ShadowDepth="0" Opacity="0.6"/>
                                            </Border.Effect>
                                            <Border CornerRadius="6">
                                                <Border.Background>
                                                    <ImageBrush ImageSource="{Binding AvatarUrl}" Stretch="UniformToFill"/>
                                                </Border.Background>
                                            </Border>
                                        </Border>
                                        <Border Width="14" Height="14" CornerRadius="7"
                                                HorizontalAlignment="Right" VerticalAlignment="Bottom"
                                                Margin="0,0,-2,-2"
                                                Background="#020408" BorderThickness="2"
                                                BorderBrush="#020408">
                                            <Ellipse Fill="#00FF9F">
                                                <Ellipse.Effect>
                                                    <DropShadowEffect Color="#00FF9F" BlurRadius="4" ShadowDepth="0"/>
                                                </Ellipse.Effect>
                                            </Ellipse>
                                        </Border>
                                    </Grid>

                                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                        <controls:UserNameplate Username="{Binding Username}"
                                                                Role="{Binding Role}"
                                                                Rank="{Binding Rank}"
                                                                ShowRoleBadge="True"
                                                                ShowRankBadge="False"
                                                                FontSizeOverride="13"/>
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <!-- Offline Section -->
                <Border Margin="8,16,8,4" Padding="10,6" CornerRadius="6"
                        Background="#10101828"
                        x:Name="OfflineHeader" Visibility="Collapsed">
                    <StackPanel Orientation="Horizontal">
                        <Ellipse Width="8" Height="8" Fill="#506080" Margin="0,0,10,0"/>
                        <TextBlock x:Name="OfflineHeaderText" Text="OFFLINE â€” 0"
                                   FontSize="11" FontWeight="SemiBold"
                                   Foreground="#506080" CharacterSpacing="30"/>
                    </StackPanel>
                </Border>

                <ItemsControl x:Name="OfflineMembersControl" Visibility="Collapsed">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Cursor="Hand" Margin="6,2" CornerRadius="8"
                                    Padding="10,8" Opacity="0.6"
                                    ContextMenu="{StaticResource MemberContextMenu}"
                                    Tag="{Binding}">
                                <Border.Background>
                                    <SolidColorBrush Color="Transparent"/>
                                </Border.Background>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <Grid Grid.Column="0" Margin="0,0,12,0">
                                        <Border Width="36" Height="36" CornerRadius="8"
                                                BorderThickness="1" BorderBrush="#30506080">
                                            <Border CornerRadius="7">
                                                <Border.Background>
                                                    <ImageBrush ImageSource="{Binding AvatarUrl}" Stretch="UniformToFill"/>
                                                </Border.Background>
                                            </Border>
                                        </Border>
                                        <Ellipse Width="12" Height="12" Fill="#506080"
                                                 HorizontalAlignment="Right" VerticalAlignment="Bottom"
                                                 Stroke="#020408" StrokeThickness="2"
                                                 Margin="0,0,-2,-2"/>
                                    </Grid>

                                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                        <TextBlock Text="{Binding Username}" FontSize="13"
                                                   Foreground="#6080A0"/>
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </StackPanel>
        </ScrollViewer>

        <!-- Profile Popup (Blade Style) -->
        <Popup x:Name="ProfilePopup" Placement="Left" StaysOpen="False"
               AllowsTransparency="True" Grid.RowSpan="2">
            <Border CornerRadius="16" Padding="0" Width="340" Margin="10"
                    BorderThickness="2">
                <Border.Background>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                        <GradientStop Color="#F8080C18" Offset="0"/>
                        <GradientStop Color="#F8101828" Offset="0.5"/>
                        <GradientStop Color="#F8080C18" Offset="1"/>
                    </LinearGradientBrush>
                </Border.Background>
                <Border.BorderBrush>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                        <GradientStop Color="#00FF9F" Offset="0"/>
                        <GradientStop Color="#00E5FF" Offset="0.5"/>
                        <GradientStop Color="#B366FF" Offset="1"/>
                    </LinearGradientBrush>
                </Border.BorderBrush>
                <Border.Effect>
                    <DropShadowEffect BlurRadius="30" ShadowDepth="0" Opacity="0.7" Color="#00FF9F"/>
                </Border.Effect>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Banner with gradient -->
                    <Border Grid.Row="0" Height="90" CornerRadius="14,14,0,0">
                        <Border.Background>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                <GradientStop x:Name="BannerGradient1" Color="#00FF9F" Offset="0"/>
                                <GradientStop x:Name="BannerGradient2" Color="#B366FF" Offset="1"/>
                            </LinearGradientBrush>
                        </Border.Background>
                        <!-- Decorative pattern overlay -->
                        <Border CornerRadius="14,14,0,0" Opacity="0.3">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="0.2,0.2" SpreadMethod="Repeat">
                                    <GradientStop Color="Transparent" Offset="0"/>
                                    <GradientStop Color="#20FFFFFF" Offset="0.5"/>
                                    <GradientStop Color="Transparent" Offset="1"/>
                                </LinearGradientBrush>
                            </Border.Background>
                        </Border>
                    </Border>

                    <!-- Avatar -->
                    <Border Grid.Row="0" Grid.RowSpan="2" Width="100" Height="100"
                            CornerRadius="16" Background="#080C18"
                            HorizontalAlignment="Left" VerticalAlignment="Bottom"
                            Margin="18,-35,0,0" BorderThickness="4">
                        <Border.BorderBrush>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                <GradientStop Color="#00FF9F" Offset="0"/>
                                <GradientStop Color="#00E5FF" Offset="1"/>
                            </LinearGradientBrush>
                        </Border.BorderBrush>
                        <Border.Effect>
                            <DropShadowEffect Color="#00FF9F" BlurRadius="15" ShadowDepth="0" Opacity="0.6"/>
                        </Border.Effect>
                        <Border Width="88" Height="88" CornerRadius="12">
                            <Border.Background>
                                <ImageBrush x:Name="PopupAvatarBrush" Stretch="UniformToFill"/>
                            </Border.Background>
                        </Border>
                    </Border>

                    <!-- User Info -->
                    <StackPanel Grid.Row="1" Margin="18,12,18,0">
                        <StackPanel Orientation="Horizontal" Margin="108,0,0,0">
                            <TextBlock x:Name="PopupUsernameText" FontSize="18" FontWeight="Bold"
                                       Foreground="#E0E8FF">
                                <TextBlock.Effect>
                                    <DropShadowEffect Color="#00FF9F" BlurRadius="6" ShadowDepth="0" Opacity="0.5"/>
                                </TextBlock.Effect>
                            </TextBlock>
                            <Border x:Name="PopupRoleBadge" Margin="10,0,0,0" CornerRadius="6"
                                    Padding="8,3" VerticalAlignment="Center">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                        <GradientStop Color="#00FF9F" Offset="0"/>
                                        <GradientStop Color="#00E5FF" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.Background>
                                <TextBlock x:Name="PopupRoleText" FontSize="10" FontWeight="Bold"
                                           Foreground="#020408"/>
                            </Border>
                        </StackPanel>
                    </StackPanel>

                    <!-- Details -->
                    <StackPanel Grid.Row="2" Margin="18,16,18,8">
                        <!-- Status -->
                        <Border CornerRadius="10" Padding="14" Margin="0,0,0,10"
                                Background="#15101828" BorderThickness="1" BorderBrush="#2000FF9F">
                            <StackPanel>
                                <TextBlock Text="STATUS" FontSize="10" FontWeight="Bold"
                                           Foreground="#6080A0" Margin="0,0,0,6" CharacterSpacing="50"/>
                                <TextBlock x:Name="PopupStatusText" FontSize="13" Foreground="#C0C8E0"
                                           TextWrapping="Wrap"/>
                            </StackPanel>
                        </Border>

                        <!-- Bio -->
                        <Border x:Name="PopupBioSection" CornerRadius="10"
                                Padding="14" Margin="0,0,0,10" Visibility="Collapsed"
                                Background="#15101828" BorderThickness="1" BorderBrush="#2000E5FF">
                            <StackPanel>
                                <TextBlock Text="ABOUT ME" FontSize="10" FontWeight="Bold"
                                           Foreground="#6080A0" Margin="0,0,0,6" CharacterSpacing="50"/>
                                <TextBlock x:Name="PopupBioText" FontSize="12" Foreground="#A0A8C0"
                                           TextWrapping="Wrap"/>
                            </StackPanel>
                        </Border>

                        <!-- Member Since -->
                        <Border CornerRadius="10" Padding="14"
                                Background="#15101828" BorderThickness="1" BorderBrush="#20B366FF">
                            <StackPanel>
                                <TextBlock Text="MEMBER SINCE" FontSize="10" FontWeight="Bold"
                                           Foreground="#6080A0" Margin="0,0,0,6" CharacterSpacing="50"/>
                                <TextBlock x:Name="PopupMemberSinceText" FontSize="12" Foreground="#A0A8C0"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>

                    <!-- Actions -->
                    <StackPanel Grid.Row="3" Margin="18,8,18,18" Orientation="Horizontal">
                        <Button Content="ðŸ’¬ Message" Click="PopupMessage_Click" Cursor="Hand"
                                Margin="0,0,8,0" Style="{StaticResource BladeNavButton}"/>
                        <Button Content="âž• Add Friend" Click="PopupAddFriend_Click" Cursor="Hand"
                                Margin="0,0,8,0" Style="{StaticResource BladeNavButton}"/>
                        <Button Content="ðŸ‘‹" ToolTip="Nudge" Click="PopupNudge_Click" Cursor="Hand"
                                Style="{StaticResource BladeIconButton}" Width="40" Height="40"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Popup>
    </Grid>
</UserControl>
