<![CDATA[<UserControl x:Class="VeaMarketplace.Client.Views.ProductReviewsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="800">
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Styles/Colors.xaml"/>
                <ResourceDictionary Source="/Styles/Buttons.xaml"/>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </UserControl.Resources>

    <Grid Background="{StaticResource PrimaryDark}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="{StaticResource SecondaryDark}" Padding="20" BorderBrush="{StaticResource TertiaryDark}" BorderThickness="0,0,0,1">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0">
                    <TextBlock Text="Product Reviews" FontSize="24" FontWeight="Bold" Foreground="White"/>
                    <TextBlock Text="{Binding ProductTitle}" FontSize="14" Foreground="{StaticResource TextSecondary}" Margin="0,5,0,0"/>
                </StackPanel>

                <Button Grid.Column="1" Content="Write Review" Style="{StaticResource AccentButton}"
                        Command="{Binding OpenWriteReviewCommand}" VerticalAlignment="Center"
                        Padding="20,10" FontSize="14" FontWeight="SemiBold"/>
            </Grid>
        </Border>

        <!-- Rating Summary -->
        <Border Grid.Row="1" Background="{StaticResource SecondaryDark}" Padding="20" Margin="0,0,0,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Average Rating -->
                <StackPanel Grid.Column="0" Margin="0,0,40,0">
                    <TextBlock Text="{Binding AverageRating, StringFormat={}{0:F1}}"
                               FontSize="48" FontWeight="Bold" Foreground="{StaticResource Blurple}"
                               HorizontalAlignment="Center"/>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,5,0,0">
                        <TextBlock Text="â˜…â˜…â˜…â˜…â˜…" FontSize="20" Foreground="{StaticResource Blurple}"/>
                    </StackPanel>
                    <TextBlock Text="{Binding TotalReviews, StringFormat={}{0} reviews}"
                               FontSize="12" Foreground="{StaticResource TextSecondary}"
                               HorizontalAlignment="Center" Margin="0,5,0,0"/>
                </StackPanel>

                <!-- Rating Breakdown -->
                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                    <ItemsControl ItemsSource="{Binding RatingBreakdown}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Grid Margin="0,3">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="60"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="50"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0" Text="{Binding Stars, StringFormat={}{0} â˜…}"
                                               Foreground="{StaticResource TextSecondary}" VerticalAlignment="Center"/>

                                    <Border Grid.Column="1" Height="8" Background="{StaticResource TertiaryDark}"
                                            CornerRadius="4" Margin="10,0">
                                        <Border Width="{Binding PercentWidth}" HorizontalAlignment="Left"
                                                Background="{StaticResource Blurple}" CornerRadius="4"/>
                                    </Border>

                                    <TextBlock Grid.Column="2" Text="{Binding Count}"
                                               Foreground="{StaticResource TextSecondary}"
                                               HorizontalAlignment="Right" VerticalAlignment="Center"/>
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>

                <!-- Filter Options -->
                <StackPanel Grid.Column="2" Margin="40,0,0,0">
                    <TextBlock Text="Sort by" FontSize="12" Foreground="{StaticResource TextSecondary}" Margin="0,0,0,5"/>
                    <ComboBox Width="150" SelectedIndex="0">
                        <ComboBoxItem Content="Most Recent"/>
                        <ComboBoxItem Content="Highest Rating"/>
                        <ComboBoxItem Content="Lowest Rating"/>
                        <ComboBoxItem Content="Most Helpful"/>
                        <ComboBoxItem Content="Verified Purchase"/>
                    </ComboBox>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Reviews List -->
        <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
            <ItemsControl ItemsSource="{Binding Reviews}" Margin="20,0">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Background="{StaticResource SecondaryDark}"
                                CornerRadius="8" Padding="20" Margin="0,0,0,15">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Review Header -->
                                <Grid Grid.Row="0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- User Info -->
                                    <StackPanel Grid.Column="0" Orientation="Horizontal">
                                        <Ellipse Width="40" Height="40">
                                            <Ellipse.Fill>
                                                <ImageBrush ImageSource="{Binding UserAvatarUrl}"/>
                                            </Ellipse.Fill>
                                        </Ellipse>
                                        <StackPanel Margin="10,0,0,0" VerticalAlignment="Center">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="{Binding Username}" FontWeight="SemiBold"
                                                           Foreground="White" FontSize="14"/>
                                                <Border Background="{StaticResource Green}" CornerRadius="3"
                                                        Padding="5,2" Margin="8,0,0,0"
                                                        Visibility="{Binding IsVerifiedPurchase, Converter={StaticResource BoolToVisibilityConverter}}">
                                                    <TextBlock Text="âœ“ Verified Purchase" FontSize="10"
                                                               Foreground="White" FontWeight="SemiBold"/>
                                                </Border>
                                            </StackPanel>
                                            <TextBlock Text="{Binding CreatedAt, StringFormat='Posted on {0:MMM dd, yyyy}'}"
                                                       FontSize="11" Foreground="{StaticResource TextSecondary}" Margin="0,2,0,0"/>
                                        </StackPanel>
                                    </StackPanel>

                                    <!-- Rating Stars -->
                                    <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                                        <TextBlock Text="â˜…â˜…â˜…â˜…â˜…" FontSize="16" Foreground="{StaticResource Blurple}"/>
                                        <TextBlock Text="{Binding Rating, StringFormat={}{0}.0}"
                                                   FontSize="14" FontWeight="Bold" Foreground="White"
                                                   Margin="8,0,0,0" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Grid>

                                <!-- Review Title -->
                                <TextBlock Grid.Row="1" Text="{Binding Title}"
                                           FontSize="16" FontWeight="SemiBold" Foreground="White"
                                           Margin="0,15,0,8"/>

                                <!-- Review Content -->
                                <TextBlock Grid.Row="2" Text="{Binding Content}"
                                           FontSize="14" Foreground="{StaticResource TextPrimary}"
                                           TextWrapping="Wrap" LineHeight="20"/>

                                <!-- Review Images -->
                                <ItemsControl Grid.Row="3" ItemsSource="{Binding ImageUrls}" Margin="0,10,0,0">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <WrapPanel/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Width="100" Height="100" CornerRadius="6"
                                                    Margin="0,0,10,10" BorderBrush="{StaticResource TertiaryDark}"
                                                    BorderThickness="1">
                                                <Image Source="{Binding}" Stretch="UniformToFill"/>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                                <!-- Review Actions -->
                                <Grid Grid.Row="4" Margin="0,15,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Grid.Column="0" Orientation="Horizontal">
                                        <Button Content="{Binding HelpfulCount, StringFormat='ðŸ‘ Helpful ({0})'}"
                                                Style="{StaticResource SecondaryButton}"
                                                Command="{Binding DataContext.MarkHelpfulCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                CommandParameter="{Binding}"
                                                Padding="12,6" FontSize="12"/>
                                        <Button Content="Report" Style="{StaticResource SecondaryButton}"
                                                Command="{Binding DataContext.ReportReviewCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                CommandParameter="{Binding}"
                                                Padding="12,6" FontSize="12" Margin="8,0,0,0"/>
                                    </StackPanel>
                                </Grid>

                                <!-- Seller Response -->
                                <Border Grid.Row="4" Background="{StaticResource TertiaryDark}"
                                        CornerRadius="6" Padding="15" Margin="0,15,0,0"
                                        Visibility="{Binding SellerResponse, Converter={StaticResource NullToVisibilityConverter}}">
                                    <StackPanel>
                                        <TextBlock Text="Seller Response" FontSize="12" FontWeight="SemiBold"
                                                   Foreground="{StaticResource Blurple}" Margin="0,0,0,8"/>
                                        <TextBlock Text="{Binding SellerResponse}" FontSize="13"
                                                   Foreground="{StaticResource TextPrimary}" TextWrapping="Wrap"/>
                                        <TextBlock Text="{Binding SellerResponseAt, StringFormat='Responded on {0:MMM dd, yyyy}'}"
                                                   FontSize="11" Foreground="{StaticResource TextSecondary}" Margin="0,8,0,0"/>
                                    </StackPanel>
                                </Border>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <!-- Load More -->
        <Button Grid.Row="3" Content="Load More Reviews" Style="{StaticResource SecondaryButton}"
                Command="{Binding LoadMoreCommand}"
                HorizontalAlignment="Center" Margin="20" Padding="30,12"/>
    </Grid>
</UserControl>
]]>