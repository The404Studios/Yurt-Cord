<Window x:Class="VeaMarketplace.Client.Views.UserSearchDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Find Users"
        Width="450" Height="500"
        WindowStartupLocation="CenterOwner"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ResizeMode="NoResize">

    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Styles/Colors.xaml"/>
                <ResourceDictionary Source="/Styles/Buttons.xaml"/>
                <ResourceDictionary Source="/Styles/Controls.xaml"/>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </Window.Resources>

    <Border Background="{StaticResource TertiaryDarkBrush}"
            CornerRadius="8"
            BorderThickness="1"
            BorderBrush="{StaticResource QuaternaryDarkBrush}">
        <Border.Effect>
            <DropShadowEffect BlurRadius="30" ShadowDepth="0" Opacity="0.6" Color="Black"/>
        </Border.Effect>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <Grid Grid.Row="0" Background="{StaticResource SecondaryDarkBrush}">
                <Grid Margin="16,12">
                    <TextBlock Text="Find Users"
                               FontSize="16"
                               FontWeight="SemiBold"
                               Foreground="{StaticResource TextPrimaryBrush}"
                               VerticalAlignment="Center"/>
                    <Button x:Name="CloseButton"
                            HorizontalAlignment="Right"
                            Background="Transparent"
                            BorderThickness="0"
                            Cursor="Hand"
                            Click="Close_Click">
                        <TextBlock Text="&#xE711;"
                                   FontFamily="Segoe MDL2 Assets"
                                   FontSize="12"
                                   Foreground="{StaticResource TextMutedBrush}"/>
                    </Button>
                </Grid>
            </Grid>

            <!-- Search Input -->
            <Grid Grid.Row="1" Margin="16,16,16,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBox x:Name="SearchTextBox"
                         Style="{StaticResource ModernTextBox}"
                         Padding="40,10,12,10"
                         FontSize="14"
                         TextChanged="SearchTextBox_TextChanged"
                         KeyDown="SearchTextBox_KeyDown">
                    <TextBox.Resources>
                        <Style TargetType="Border">
                            <Setter Property="CornerRadius" Value="4"/>
                        </Style>
                    </TextBox.Resources>
                </TextBox>

                <!-- Search Icon -->
                <TextBlock Text="&#xE721;"
                           FontFamily="Segoe MDL2 Assets"
                           FontSize="16"
                           Foreground="{StaticResource TextMutedBrush}"
                           VerticalAlignment="Center"
                           Margin="12,0,0,0"
                           IsHitTestVisible="False"/>

                <Button Grid.Column="1"
                        Content="Search"
                        Style="{StaticResource PrimaryButton}"
                        Padding="16,10"
                        Margin="8,0,0,0"
                        Click="Search_Click"/>
            </Grid>

            <!-- Search Hint -->
            <TextBlock Grid.Row="1"
                       Text="Search by username or user ID"
                       FontSize="11"
                       Foreground="{StaticResource TextMutedBrush}"
                       Margin="16,52,16,0"/>

            <!-- Results -->
            <Grid Grid.Row="2" Margin="16,16,16,0">
                <!-- Loading Indicator -->
                <StackPanel x:Name="LoadingPanel"
                            VerticalAlignment="Center"
                            HorizontalAlignment="Center"
                            Visibility="Collapsed">
                    <TextBlock Text="&#xE117;"
                               FontFamily="Segoe MDL2 Assets"
                               FontSize="24"
                               Foreground="{StaticResource TextMutedBrush}"
                               HorizontalAlignment="Center">
                        <TextBlock.RenderTransform>
                            <RotateTransform x:Name="LoadingRotate" CenterX="12" CenterY="12"/>
                        </TextBlock.RenderTransform>
                        <TextBlock.Triggers>
                            <EventTrigger RoutedEvent="Loaded">
                                <BeginStoryboard>
                                    <Storyboard RepeatBehavior="Forever">
                                        <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(RotateTransform.Angle)"
                                                         From="0" To="360"
                                                         Duration="0:0:1"/>
                                    </Storyboard>
                                </BeginStoryboard>
                            </EventTrigger>
                        </TextBlock.Triggers>
                    </TextBlock>
                    <TextBlock Text="Searching..."
                               Foreground="{StaticResource TextMutedBrush}"
                               Margin="0,8,0,0"/>
                </StackPanel>

                <!-- No Results -->
                <StackPanel x:Name="NoResultsPanel"
                            VerticalAlignment="Center"
                            HorizontalAlignment="Center"
                            Visibility="Collapsed">
                    <TextBlock Text="&#xE773;"
                               FontFamily="Segoe MDL2 Assets"
                               FontSize="32"
                               Foreground="{StaticResource TextMutedBrush}"
                               HorizontalAlignment="Center"/>
                    <TextBlock Text="No users found"
                               FontSize="14"
                               Foreground="{StaticResource TextMutedBrush}"
                               Margin="0,8,0,0"/>
                </StackPanel>

                <!-- Results List -->
                <ListBox x:Name="ResultsListBox"
                         Style="{StaticResource ModernListBox}"
                         Background="Transparent"
                         BorderThickness="0"
                         ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                         SelectionChanged="ResultsListBox_SelectionChanged">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Border Background="{StaticResource SecondaryDarkBrush}"
                                    CornerRadius="4"
                                    Padding="12"
                                    Margin="0,4"
                                    Cursor="Hand">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Avatar -->
                                    <Border Width="40" Height="40"
                                            CornerRadius="20"
                                            Background="{StaticResource AccentBrush}">
                                        <TextBlock Text="{Binding Username[0]}"
                                                   FontSize="16"
                                                   FontWeight="Bold"
                                                   Foreground="White"
                                                   HorizontalAlignment="Center"
                                                   VerticalAlignment="Center"/>
                                    </Border>

                                    <!-- User Info -->
                                    <StackPanel Grid.Column="1" Margin="12,0,0,0" VerticalAlignment="Center">
                                        <TextBlock Text="{Binding Username}"
                                                   FontSize="14"
                                                   FontWeight="SemiBold"
                                                   Foreground="{StaticResource TextPrimaryBrush}"/>
                                        <TextBlock Text="{Binding Id, StringFormat='ID: {0}'}"
                                                   FontSize="11"
                                                   Foreground="{StaticResource TextMutedBrush}"/>
                                    </StackPanel>

                                    <!-- Action Button -->
                                    <Button Grid.Column="2"
                                            Content="Add Friend"
                                            Style="{StaticResource SecondaryButton}"
                                            Padding="12,6"
                                            FontSize="12"
                                            Tag="{Binding}"
                                            Click="AddFriend_Click"/>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </Grid>

            <!-- Footer -->
            <Border Grid.Row="3"
                    Background="{StaticResource SecondaryDarkBrush}"
                    Padding="16,12">
                <Button Content="Close"
                        Style="{StaticResource SecondaryButton}"
                        Padding="24,8"
                        HorizontalAlignment="Right"
                        Click="Close_Click"/>
            </Border>
        </Grid>
    </Border>
</Window>
