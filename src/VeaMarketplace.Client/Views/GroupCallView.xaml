<UserControl x:Class="VeaMarketplace.Client.Views.GroupCallView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:converters="clr-namespace:VeaMarketplace.Client.Converters"
             Background="{DynamicResource BladeSurfaceBrush}">

    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="../Themes/BladeUI.xaml"/>
            </ResourceDictionary.MergedDictionaries>

            <BooleanToVisibilityConverter x:Key="BoolToVis"/>
            <converters:AudioLevelToHeightConverter x:Key="AudioLevelToHeightConverter"/>

            <!-- Control Button Style -->
            <Style x:Key="CallControlButton" TargetType="Button">
                <Setter Property="Width" Value="52"/>
                <Setter Property="Height" Value="52"/>
                <Setter Property="Cursor" Value="Hand"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Border x:Name="border" CornerRadius="26"
                                    Background="{StaticResource BladeHighlightBrush}"
                                    BorderThickness="1" BorderBrush="Transparent">
                                <Border.Effect>
                                    <DropShadowEffect Color="#00FF9F" BlurRadius="0" ShadowDepth="0" Opacity="0"/>
                                </Border.Effect>
                                <ContentPresenter HorizontalAlignment="Center"
                                                VerticalAlignment="Center"/>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="border" Property="Background" Value="{StaticResource BladeElevatedBrush}"/>
                                    <Setter TargetName="border" Property="BorderBrush" Value="#00FF9F50"/>
                                    <Setter TargetName="border" Property="Effect">
                                        <Setter.Value>
                                            <DropShadowEffect Color="#00FF9F" BlurRadius="10" ShadowDepth="0" Opacity="0.4"/>
                                        </Setter.Value>
                                    </Setter>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- Active Control Button (for toggled states) -->
            <Style x:Key="CallControlButtonActive" TargetType="Button">
                <Setter Property="Width" Value="52"/>
                <Setter Property="Height" Value="52"/>
                <Setter Property="Cursor" Value="Hand"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Border x:Name="border" CornerRadius="26">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                        <GradientStop Color="#00FF9F" Offset="0"/>
                                        <GradientStop Color="#00E5FF" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.Background>
                                <Border.Effect>
                                    <DropShadowEffect Color="#00FF9F" BlurRadius="12" ShadowDepth="0" Opacity="0.5"/>
                                </Border.Effect>
                                <ContentPresenter HorizontalAlignment="Center"
                                                VerticalAlignment="Center"/>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="border" Property="Effect">
                                        <Setter.Value>
                                            <DropShadowEffect Color="#00FF9F" BlurRadius="16" ShadowDepth="0" Opacity="0.7"/>
                                        </Setter.Value>
                                    </Setter>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- Leave Button Style -->
            <Style x:Key="LeaveCallButton" TargetType="Button">
                <Setter Property="Width" Value="52"/>
                <Setter Property="Height" Value="52"/>
                <Setter Property="Cursor" Value="Hand"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Border x:Name="border" CornerRadius="26"
                                    Background="{StaticResource BladeNeonRedBrush}">
                                <Border.Effect>
                                    <DropShadowEffect Color="#FF4466" BlurRadius="10" ShadowDepth="0" Opacity="0.5"/>
                                </Border.Effect>
                                <ContentPresenter HorizontalAlignment="Center"
                                                VerticalAlignment="Center"/>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="border" Property="Effect">
                                        <Setter.Value>
                                            <DropShadowEffect Color="#FF4466" BlurRadius="15" ShadowDepth="0" Opacity="0.7"/>
                                        </Setter.Value>
                                    </Setter>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- Small Icon Button -->
            <Style x:Key="SmallIconButton" TargetType="Button">
                <Setter Property="Width" Value="36"/>
                <Setter Property="Height" Value="36"/>
                <Setter Property="Cursor" Value="Hand"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Border x:Name="border" CornerRadius="8"
                                    Background="Transparent" BorderThickness="1" BorderBrush="Transparent">
                                <ContentPresenter HorizontalAlignment="Center"
                                                VerticalAlignment="Center"/>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="border" Property="Background" Value="{StaticResource BladeHighlightBrush}"/>
                                    <Setter TargetName="border" Property="BorderBrush" Value="#00FF9F40"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
        </ResourceDictionary>
    </UserControl.Resources>

    <Grid>
        <!-- Main Content Area -->
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Participant Grid Area -->
            <Grid Grid.Row="0" Background="{StaticResource BladeSurfaceBrush}">
                <!-- Header Bar -->
                <Border VerticalAlignment="Top" Background="{StaticResource BladePanelBrush}"
                        Padding="16,12" Panel.ZIndex="10">
                    <Grid>
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <!-- Call Icon -->
                            <Border Width="40" Height="40" CornerRadius="20"
                                    Background="{StaticResource BladeNeonGreenBrush}" Margin="0,0,12,0">
                                <Path Data="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"
                                      Fill="White" Width="20" Height="20"
                                      Stretch="Uniform" HorizontalAlignment="Center"
                                      VerticalAlignment="Center"/>
                            </Border>
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock x:Name="CallNameText" Text="Group Call"
                                           FontSize="16" FontWeight="SemiBold"
                                           Foreground="{StaticResource BladeTextPrimaryBrush}"/>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock x:Name="ParticipantCountText" Text="0 participants"
                                               FontSize="13" Foreground="{StaticResource BladeTextSecondaryBrush}"/>
                                    <TextBlock Text=" â€¢ " FontSize="13" Foreground="#4E5058"/>
                                    <TextBlock x:Name="DurationText" Text="00:00"
                                               FontSize="13" Foreground="{StaticResource BladeTextSecondaryBrush}"/>
                                </StackPanel>
                            </StackPanel>
                        </StackPanel>

                        <!-- Header Actions -->
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                            <Button Style="{StaticResource SmallIconButton}"
                                    Click="Invite_Click" ToolTip="Add People">
                                <Path Data="M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm-9-2V7H4v3H1v2h3v3h2v-3h3v-2H6zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"
                                      Fill="{StaticResource BladeTextSecondaryBrush}" Width="20" Height="20" Stretch="Uniform"/>
                            </Button>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Participants Grid -->
                <ScrollViewer VerticalScrollBarVisibility="Auto" Margin="0,64,0,0"
                              HorizontalScrollBarVisibility="Disabled">
                    <ItemsControl x:Name="ParticipantsGrid" Margin="24">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel HorizontalAlignment="Center"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <!-- Participant Tile -->
                                <Border Width="240" Height="200" Margin="8" CornerRadius="8"
                                        Background="{StaticResource BladeDeepBrush}" Tag="{Binding}"
                                        MouseLeftButtonUp="Participant_Click" Cursor="Hand">
                                    <Grid>
                                        <!-- Speaking Glow Border -->
                                        <Border x:Name="SpeakingBorder" CornerRadius="8"
                                                BorderThickness="2" BorderBrush="{StaticResource BladeNeonGreenBrush}"
                                                Visibility="{Binding IsSpeaking, Converter={StaticResource BoolToVis}}"/>

                                        <!-- Content -->
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="*"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>

                                            <!-- Avatar Area -->
                                            <Grid Grid.Row="0" VerticalAlignment="Center">
                                                <Grid Width="100" Height="100" HorizontalAlignment="Center">
                                                    <!-- Avatar -->
                                                    <Ellipse Width="100" Height="100">
                                                        <Ellipse.Fill>
                                                            <ImageBrush ImageSource="{Binding AvatarUrl}"
                                                                        Stretch="UniformToFill"/>
                                                        </Ellipse.Fill>
                                                    </Ellipse>
                                                    <!-- Speaking Ring -->
                                                    <Ellipse Width="100" Height="100"
                                                             StrokeThickness="3" Stroke="{StaticResource BladeNeonGreenBrush}"
                                                             Visibility="{Binding IsSpeaking, Converter={StaticResource BoolToVis}}"/>
                                                    <!-- Screen Share Indicator -->
                                                    <Border VerticalAlignment="Bottom"
                                                            HorizontalAlignment="Right"
                                                            Background="{StaticResource BladeNeonGreenBrush}" CornerRadius="4"
                                                            Padding="4,2" Margin="0,0,-4,-4"
                                                            Visibility="{Binding IsScreenSharing, Converter={StaticResource BoolToVis}}">
                                                        <Path Data="M21 3H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H3V5h18v14z"
                                                              Fill="White" Width="12" Height="12" Stretch="Uniform"/>
                                                    </Border>
                                                </Grid>
                                            </Grid>

                                            <!-- User Info Bar -->
                                            <Border Grid.Row="1" Background="{StaticResource BladeBlackBrush}"
                                                    Padding="12,8"
                                                    CornerRadius="0,0,8,8">
                                                <Grid>
                                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                        <TextBlock Text="{Binding Username}"
                                                                   FontSize="14" FontWeight="Medium"
                                                                   Foreground="{StaticResource BladeTextPrimaryBrush}"
                                                                   VerticalAlignment="Center"/>
                                                        <!-- Host Badge -->
                                                        <Border Background="{StaticResource BladeNeonCyanBrush}" CornerRadius="3"
                                                                Padding="5,2" Margin="6,0,0,0"
                                                                Visibility="{Binding IsHost, Converter={StaticResource BoolToVis}}">
                                                            <TextBlock Text="HOST" FontSize="9"
                                                                       FontWeight="Bold" Foreground="White"/>
                                                        </Border>
                                                    </StackPanel>

                                                    <!-- Status Icons -->
                                                    <StackPanel Orientation="Horizontal"
                                                                HorizontalAlignment="Right"
                                                                VerticalAlignment="Center">
                                                        <!-- Muted -->
                                                        <Border Background="{StaticResource BladeNeonRedBrush}" CornerRadius="3"
                                                                Padding="4,2" Margin="4,0,0,0"
                                                                Visibility="{Binding IsMuted, Converter={StaticResource BoolToVis}}">
                                                            <Path Data="M19 11h-1.7c0 .74-.16 1.43-.43 2.05l1.23 1.23c.56-.98.9-2.09.9-3.28zm-4.02.17c0-.06.02-.11.02-.17V5c0-1.66-1.34-3-3-3S9 3.34 9 5v.18l5.98 5.99zM4.27 3L3 4.27l6.01 6.01V11c0 1.66 1.33 3 2.99 3 .22 0 .44-.03.65-.08l1.66 1.66c-.71.33-1.5.52-2.31.52-2.76 0-5.3-2.1-5.3-5.1H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c.91-.13 1.77-.45 2.54-.9L19.73 21 21 19.73 4.27 3z"
                                                                  Fill="White" Width="12" Height="12" Stretch="Uniform"/>
                                                        </Border>
                                                        <!-- Deafened -->
                                                        <Border Background="{StaticResource BladeNeonRedBrush}" CornerRadius="3"
                                                                Padding="4,2" Margin="4,0,0,0"
                                                                Visibility="{Binding IsDeafened, Converter={StaticResource BoolToVis}}">
                                                            <Path Data="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"
                                                                  Fill="White" Width="12" Height="12" Stretch="Uniform"/>
                                                        </Border>
                                                    </StackPanel>
                                                </Grid>
                                            </Border>
                                        </Grid>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>

                <!-- Empty State -->
                <StackPanel x:Name="EmptyCallState" Visibility="Collapsed"
                            VerticalAlignment="Center" HorizontalAlignment="Center">
                    <Border Width="80" Height="80" CornerRadius="40"
                            Background="{StaticResource BladePanelBrush}" Margin="0,0,0,16"
                            HorizontalAlignment="Center">
                        <Path Data="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"
                              Fill="{StaticResource BladeTextSecondaryBrush}" Width="36" Height="36" Stretch="Uniform"
                              HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Border>
                    <TextBlock Text="Waiting for others to join..."
                               FontSize="16" Foreground="{StaticResource BladeTextSecondaryBrush}"
                               HorizontalAlignment="Center"/>
                </StackPanel>
            </Grid>

            <!-- Bottom Controls Bar -->
            <Border Grid.Row="1" Background="{StaticResource BladeDeepBrush}" Padding="16,12">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Left Side - Self Info -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal"
                                VerticalAlignment="Center">
                        <!-- Self Avatar with Speaking Indicator -->
                        <Grid Width="40" Height="40" Margin="0,0,12,0">
                            <Ellipse Width="40" Height="40">
                                <Ellipse.Fill>
                                    <ImageBrush x:Name="SelfAvatarBrush" Stretch="UniformToFill"/>
                                </Ellipse.Fill>
                            </Ellipse>
                            <Ellipse x:Name="SelfSpeakingRing" Width="40" Height="40"
                                     StrokeThickness="2" Stroke="{StaticResource BladeNeonGreenBrush}" Visibility="Collapsed"/>
                        </Grid>
                        <StackPanel VerticalAlignment="Center">
                            <TextBlock x:Name="SelfUsernameText" FontSize="14"
                                       FontWeight="Medium" Foreground="{StaticResource BladeTextPrimaryBrush}"/>
                            <TextBlock x:Name="SelfStatusText" Text="Connected"
                                       FontSize="12" Foreground="{StaticResource BladeNeonGreenBrush}"/>
                        </StackPanel>
                    </StackPanel>

                    <!-- Center - Main Controls -->
                    <StackPanel Grid.Column="1" Orientation="Horizontal"
                                HorizontalAlignment="Center">
                        <!-- Screen Share -->
                        <Button x:Name="ScreenShareBtn" Style="{StaticResource CallControlButton}"
                                Click="ScreenShare_Click" ToolTip="Share Your Screen"
                                Margin="4,0">
                            <Path x:Name="ScreenSharePath"
                                  Data="M21 3H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H3V5h18v14z M10 8v8l5-4z"
                                  Fill="{StaticResource BladeTextSecondaryBrush}" Width="22" Height="22" Stretch="Uniform"/>
                        </Button>

                        <!-- Mute -->
                        <Button x:Name="MuteBtn" Style="{StaticResource CallControlButton}"
                                Click="Mute_Click" ToolTip="Mute" Margin="4,0">
                            <Path x:Name="MutePath"
                                  Data="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"
                                  Fill="{StaticResource BladeTextSecondaryBrush}" Width="22" Height="22" Stretch="Uniform"/>
                        </Button>

                        <!-- Deafen -->
                        <Button x:Name="DeafenBtn" Style="{StaticResource CallControlButton}"
                                Click="Deafen_Click" ToolTip="Deafen" Margin="4,0">
                            <Path x:Name="DeafenPath"
                                  Data="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"
                                  Fill="{StaticResource BladeTextSecondaryBrush}" Width="22" Height="22" Stretch="Uniform"/>
                        </Button>

                        <!-- Leave Call -->
                        <Button Style="{StaticResource LeaveCallButton}"
                                Click="Leave_Click" ToolTip="Leave Call" Margin="4,0">
                            <Path Data="M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.71-.29L.29 13.08c-.18-.17-.29-.42-.29-.7 0-.28.11-.53.29-.71C3.34 8.78 7.46 7 12 7s8.66 1.78 11.71 4.67c.18.18.29.43.29.71 0 .28-.11.53-.29.71l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.11-.7-.28-.79-.74-1.69-1.36-2.67-1.85-.33-.16-.56-.5-.56-.9v-3.1C15.15 9.25 13.6 9 12 9z"
                                  Fill="White" Width="22" Height="22" Stretch="Uniform"/>
                        </Button>
                    </StackPanel>

                    <!-- Right Side - Audio Level -->
                    <Grid Grid.Column="2" Margin="0,0,0,0">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right"
                                    VerticalAlignment="Center">
                            <Path Data="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"
                                  Fill="{StaticResource BladeTextSecondaryBrush}" Width="14" Height="14" Stretch="Uniform"
                                  Margin="0,0,8,0" VerticalAlignment="Center"/>
                            <Border Background="{StaticResource BladeHighlightBrush}" CornerRadius="3"
                                    Width="120" Height="6" VerticalAlignment="Center">
                                <Border x:Name="MicLevelBar" Background="{StaticResource BladeNeonGreenBrush}"
                                        CornerRadius="3" HorizontalAlignment="Left"
                                        Width="0"/>
                            </Border>
                        </StackPanel>
                    </Grid>
                </Grid>
            </Border>
        </Grid>

        <!-- Invite Modal Overlay -->
        <Grid x:Name="InviteModal" Visibility="Collapsed" Background="#80000000"
              MouseDown="InviteModal_MouseDown">
            <Border Background="{StaticResource BladeSurfaceBrush}" CornerRadius="8" Padding="0"
                    Width="440" MaxHeight="600" VerticalAlignment="Center"
                    HorizontalAlignment="Center">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Modal Header -->
                    <Border Grid.Row="0" Padding="16">
                        <Grid>
                            <TextBlock Text="Invite Friends to Call" FontSize="20"
                                       FontWeight="Bold" Foreground="{StaticResource BladeTextPrimaryBrush}"/>
                            <Button Style="{StaticResource SmallIconButton}"
                                    HorizontalAlignment="Right"
                                    Click="CloseInviteModal_Click">
                                <Path Data="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"
                                      Fill="{StaticResource BladeTextSecondaryBrush}" Width="18" Height="18" Stretch="Uniform"/>
                            </Button>
                        </Grid>
                    </Border>

                    <!-- Search Bar -->
                    <Border Grid.Row="1" Background="{StaticResource BladeDeepBrush}" CornerRadius="4"
                            Margin="16,0,16,12" Padding="12,10">
                        <Grid>
                            <Path Data="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                                  Fill="{StaticResource BladeTextMutedBrush}" Width="16" Height="16" Stretch="Uniform"
                                  VerticalAlignment="Center" HorizontalAlignment="Left"/>
                            <TextBlock x:Name="InviteSearchPlaceholder"
                                       Text="Search for friends"
                                       Foreground="{StaticResource BladeTextMutedBrush}" FontSize="14"
                                       VerticalAlignment="Center" Margin="28,0,0,0"/>
                            <TextBox x:Name="InviteSearchBox" Background="Transparent"
                                     BorderThickness="0" Foreground="{StaticResource BladeTextPrimaryBrush}"
                                     FontSize="14" VerticalAlignment="Center"
                                     Margin="28,0,0,0" CaretBrush="{StaticResource BladeNeonGreenBrush}"
                                     TextChanged="InviteSearch_TextChanged"/>
                        </Grid>
                    </Border>

                    <!-- Friends List -->
                    <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto"
                                  Margin="8,0,8,16" MaxHeight="400">
                        <ItemsControl x:Name="FriendsListControl">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Margin="8,2" Padding="8" CornerRadius="4"
                                            Background="Transparent" Cursor="Hand"
                                            Tag="{Binding}">
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Background" Value="{StaticResource BladeHighlightBrush}"/>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- Avatar with Status -->
                                            <Grid Width="40" Height="40" Margin="0,0,12,0">
                                                <Ellipse Width="40" Height="40">
                                                    <Ellipse.Fill>
                                                        <ImageBrush ImageSource="{Binding AvatarUrl}"
                                                                    Stretch="UniformToFill"/>
                                                    </Ellipse.Fill>
                                                </Ellipse>
                                                <!-- Online Status Dot -->
                                                <Ellipse Width="14" Height="14"
                                                         VerticalAlignment="Bottom"
                                                         HorizontalAlignment="Right"
                                                         Margin="0,0,-2,-2"
                                                         StrokeThickness="3" Stroke="{StaticResource BladeSurfaceBrush}">
                                                    <Ellipse.Style>
                                                        <Style TargetType="Ellipse">
                                                            <Setter Property="Fill" Value="{StaticResource BladeTextMutedBrush}"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding IsOnline}" Value="True">
                                                                    <Setter Property="Fill" Value="{StaticResource BladeNeonGreenBrush}"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Ellipse.Style>
                                                </Ellipse>
                                            </Grid>

                                            <!-- Name -->
                                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                <TextBlock Text="{Binding Username}"
                                                           FontSize="14" FontWeight="Medium"
                                                           Foreground="{StaticResource BladeTextPrimaryBrush}"/>
                                                <TextBlock FontSize="12">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Setter Property="Text" Value="Offline"/>
                                                            <Setter Property="Foreground" Value="#72767D"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding IsOnline}" Value="True">
                                                                    <Setter Property="Text" Value="Online"/>
                                                                    <Setter Property="Foreground" Value="{StaticResource BladeNeonGreenBrush}"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                </TextBlock>
                                            </StackPanel>

                                            <!-- Invite Button -->
                                            <Button Grid.Column="2" Content="Invite"
                                                    Click="InviteFriend_Click"
                                                    Tag="{Binding}" Cursor="Hand"
                                                    Padding="16,8" FontSize="13">
                                                <Button.Style>
                                                    <Style TargetType="Button">
                                                        <Setter Property="Background" Value="#5865F2"/>
                                                        <Setter Property="Foreground" Value="White"/>
                                                        <Setter Property="BorderThickness" Value="0"/>
                                                        <Setter Property="Template">
                                                            <Setter.Value>
                                                                <ControlTemplate TargetType="Button">
                                                                    <Border x:Name="border" CornerRadius="3"
                                                                            Background="{TemplateBinding Background}"
                                                                            Padding="{TemplateBinding Padding}">
                                                                        <ContentPresenter HorizontalAlignment="Center"
                                                                                        VerticalAlignment="Center"/>
                                                                    </Border>
                                                                    <ControlTemplate.Triggers>
                                                                        <Trigger Property="IsMouseOver" Value="True">
                                                                            <Setter TargetName="border"
                                                                                    Property="Background"
                                                                                    Value="#4752C4"/>
                                                                        </Trigger>
                                                                    </ControlTemplate.Triggers>
                                                                </ControlTemplate>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </Style>
                                                </Button.Style>
                                            </Button>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</UserControl>
